<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>配合比报告</title>
		<link rel="stylesheet" href="../../assets/libs/layui/css/layui.css" />
		<link rel="stylesheet" href="../../assets/module/admin.css?v=314" />
		<link rel="stylesheet" href="../../assets/css/common_likui.css?v=314" />
		<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
		<style>
			.project-setting .layui-tab-title {
            border: none;
        }
        .project-setting.layui-tab-brief>.layui-tab-title li {
            font-size: 13px;
            background-color: #fff;
            color: rgba(34, 34, 34, 1);
            padding: 0px 28px;
            line-height: 30px;
            margin-right: 24px;
        }
        .project-setting.layui-tab-brief>.layui-tab-title .layui-this {
            color: #fff;
            background-color: rgba(25, 185, 155, 1);
        }
        .project-setting.layui-tab-brief>.layui-tab-title .layui-this:after {
            content: none;
        }
        .contract-info-tip {
            height: 30px;
            line-height: 30px;
            color: rgba(107, 107, 107, 1);
            font-size: 12px;
            margin-top: -20px;
            text-align: right;
        }
        .contract-info-content {
            height: 1105px;
            /* padding-left: 355px; */
            position: relative;
        }
        .contract-info-content-left {
            width: 335px;
            height: 100%;
            background-color: #fff;
            box-shadow:0px 1px 11px 0px rgba(239,244,255,1);
            border-radius:2px;
            position: absolute;
            top: 0;
            left: 0;
            padding: 30px 15px;
            box-sizing: border-box;
        }
        .contract-info-content-right {
            width: 100%;
            height: 100%;
            background-color: #fff;
            box-shadow:0px 1px 11px 0px rgba(239,244,255,1);
            border-radius:2px;
            padding: 30px 30px;
            box-sizing: border-box;
        }
        .content-title {
            border-left: 4px solid rgba(26, 185, 155, 1);
            padding-left: 8px;
            font-size: 14px;
            line-height: 20px;
            color: rgba(51, 51, 51, 1);
            position: relative;
            font-weight: bold;
        }
        .content-title:after {
            content: '';
            width: calc(100% - 70px);
            border-top: 1px dashed rgba(208, 211, 221, 1);
            position: absolute;
            right: 0;
            top: 9px;
        }
        .table-handle li {
            float: left;
            width: 105px;
            height: 30px;
            border-bottom: 1px solid rgb(230, 230, 230);
            padding: 4px 8px;
        }
        .table-handle li:first-child {
            border-left: 1px solid rgb(230, 230, 230);
        }
        .table-handle li:last-child {
            border-right: 1px solid rgb(230, 230, 230);
            border-left: none;
            width: 45px;
        }
        .tableNum .layui-table, .layui-table-view {
            margin-bottom: 0;
        }
        .map-container {
            padding: 0 30px 10px 30px;
            position: relative;
        }
        .map-header {
            padding-right: calc(50% - 390px);
            height: 40px;
            line-height: 40px;
            padding-left: 30px;
        }
        #map-container {
            border: 1px solid #eee;
            width: calc(50% + 360px);
            height: 470px;
        }
        .search-container {
            position: absolute;
            top: 20px;
            left: 60px;
            z-index: 9;
        }
        #option-list {
            width: 260px;
            border: 1px solid #eee;
            position: absolute;
            left: 110px;
            top: 40px;
            background-color: #fff;
        }
        #option-list li {
            height: 30px;
            line-height: 30px;
            padding: 0 8px;
            cursor: pointer;
        }
        #option-list li:hover {
            background-color: #eee;
        }
        .report-container-left, .report-container-right {
            width: calc((100% - 20px) / 2);
            float: left;
        }
        .report-header {
            font-size:14px;
            font-family:PingFangSC-Medium,PingFang SC;
            font-weight:500;
            color:rgba(51,51,51,1);
            line-height:18px;
            height: 18px;
            padding-left: 8px;
            border-left: 4px solid rgba(26, 185, 155, 1);
        }
        .report-content {
            box-shadow:0px 1px 11px 0px rgba(239,244,255,1);
            border-radius:2px;
        }
        /*.report-container .layui-table .layui-table-cell {
            padding: 0px 2px;
        }
        .report-container .layui-table .layui-input {
            height: 28px;
            line-height: 28px;
        }*/

    </style>
	</head>
	<body>

		<!-- 页面加载loading -->
		<div class="page-loading">
			<div class="ball-loader">
				<span></span><span></span><span></span><span></span>
			</div>
		</div>

		<!-- 正文开始-->
		<div class="layui-fluid">
			<div class="layui-tab layui-tab-brief project-setting" lay-filter="projectContract">
				<ul class="layui-tab-title">
					<li id="jcli" class="layui-this">配合比报告</li>
				</ul>
				<div class="layui-tab-content clear">
					<div class="layui-tab-item layui-show">
						<div class="contract-info">
							<div class="contract-info-tip"><span class="text-red">*</span>红色为必填项</div>
							<div class="contract-info-content">
							<form id="modelAddProjectPbForm" lay-filter="modelAddProjectPbForm" class="layui-form">
										<div class="report-container clear layui-form">
											<div class="report-container-left mr-20">
												<div class="report-item">
													<div class="report-header">工程名称</div>
													<div class="report-content layui-form-item bg-white mt-10" style="padding: 25px 55px;">
														<div class="clear">
															<label class="layui-form-label w-auto"><span class="text-red">*</span>工程名称</label>
															<div class="layui-input-inline"  style="width: calc(100% - 160px);">
																<select lay-verify="required"  lay-filter="project_name2List" class="layui-input" name="project_name2" id="project_name2List"></select>
															</div>
														</div>
														<div class="clear" style="margin-top: 26px;">
															<label class="layui-form-label w-auto"><span class="text-red">*</span>混合料名称</label>
															<div class="layui-input-inline" style="width: calc(100% - 160px);">
																<select  lay-verify="required" lay-filter="sjxmList" class="layui-input" name="sjxm" id="sjxmList"></select>
															</div>
														</div>
														<div class="clear" style="margin-top: 26px;">
															<label class="layui-form-label w-auto"><span class="text-red">*</span>模板</label>
															<div class="layui-input-inline" style="width: calc(100% - 160px);">
																<select id="pbmb"  lay-filter="pbmb"  class="layui-input" ></select>
															</div>
														</div>
														<div class="clear" style="margin-top: 26px;">
															<label class="layui-form-label w-auto">设计依据</label>
															<div class="layui-input-inline" style="width: calc(100% - 160px);">
																<input type="text" name="sjyj" class="layui-input" id="sjyj" placeholder="请输入设计依据">
															</div>
														</div>
													</div>
												</div>
												<div class="report-item">
													<div class="report-header">高粘沥青检测指标</div>
													<div class="report-content layui-form-item bg-white mt-10" style="padding: 15px 25px;">
														<table class="layui-table" lay-skin="line">
															<colgroup>
																<col width="110">
																<col width="100">
																<col>
																<col>
															</colgroup>
															<thead>
																<tr>
																	<th colspan="2">试验项目</th>
																	<th>监测结果</th>
																	<th>技术要求</th>
																</tr>
															</thead>
															<tbody id="GllqTable">
																<tr syxm="0">
																	<td colspan="2" class="text-right">针入度（25°）0.1mm</td>
																	<td><input type="text" id="valjc0" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs0" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="1">
																	<td colspan="2" class="text-right">度（5°）cm</td>
																	<td><input type="text" id="valjc1" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs1" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="2">
																	<td colspan="2" class="text-right">软化点</td>
																	<td><input type="text" id="valjc2" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs2" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="3">
																	<td colspan="2" class="text-right">弹性恢复率</td>
																	<td><input type="text" id="valjc3" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs3" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="4">
																	<td colspan="2" class="text-right">脆点</td>
																	<td><input type="text" id="valjc4" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs4" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="5">
																	<td colspan="2" class="text-right">伞点（克利夫兰开口杯）</td>
																	<td><input type="text" id="valjc5" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs5" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="6">
																	<td rowspan="3" style="padding: 0;border-right: 1px solid #e6e6e6;" class="text-center">TFOT<br>（或RTFOT）/td>
																	<td class="text-center" style="padding: 0;">质量变化%</td>
																	<td><input type="text" id="valjc6" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs6" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="7">
																	<td class="text-center" style="padding: 0;">针入度比%</td>
																	<td><input type="text" id="valjc7" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs7" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
																<tr syxm="8">
																	<td class="text-center" style="padding: 0;">弹性恢复率%</td>
																	<td><input type="text" id="valjc8" name="result" class="layui-input" placeholder="请输入"></td>
																	<td><input type="text" id="valjs8" name="result" class="layui-input" placeholder="请输入"></td>
																</tr>
															</tbody>
														</table>
													</div>
												</div>
												<div class="report-item">
													<div class="report-header">矿粉性能检测结果</div>
													<div class="report-content layui-form-item bg-white mt-10" style="padding: 15px 25px;">
														<table class="layui-table" lay-skin="line" id="table1" lay-filter="table1"></table>
													</div>
												</div>
											</div>
											<div class="report-container-right">
												<div class="report-item">
													<div class="report-header">集料及填料基本信息表</div>
													<div class="report-content layui-form-item bg-white mt-10" style="padding: 15px 25px;">
														<table class="layui-table" lay-skin="line" id="table2" lay-filter="table2"></table>
													</div>
												</div>
												<div class="report-item">
													<div class="report-header">细集料性能指标检测结果</div>
													<div class="report-content layui-form-item bg-white mt-10" style="padding: 15px 25px;">
														<table class="layui-table" lay-skin="line" id="table3" lay-filter="table3"></table>
													</div>
												</div>
												<div class="report-item">
													<div class="report-header">粗集料性能指标检测结果</div>
													<div class="report-content layui-form-item bg-white mt-10" style="padding: 15px 25px;">
														<table class="layui-table" lay-skin="line" id="table4" lay-filter="table4"></table>
													</div>
												</div>
												<div class="report-item">
													<div class="report-header">集料筛选结果</div>
													<div class="report-content layui-form-item bg-white mt-10" style="padding: 15px 25px;">
														<table class="layui-table" lay-skin="line" id="table5" lay-filter="table5"></table>
													</div>
												</div>
											</div>
										</div>
									</form>
								</div>
								
							</div>
						</div>
					</div>
					<input type="hidden" id="project_id"  />
					<input type="hidden" id="project_name"  />
					
				<div class="text-center pt-30">
				<!-- 	<button class="layui-btn layui-btn-green1" id="addBtnclose">保存</button> -->
				<!-- 	<button class="layui-btn layui-btn-green1" id="addBtnclose">跳过</button> -->
					<button class="layui-btn layui-btn-green1"  id="addpbBtn">保存</button>
				</div>
			</div>
		</div>
		
		<!-- js部分 -->
		<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
		<script type="text/javascript" src="../../assets/js/common.js?v=314"></script>
		<script type="text/javascript" src="../../assets/libs/jquery/jquery-3.2.1.min.js"></script>
		<script charset="utf-8" src="https://map.qq.com/api/js?v=2.exp&key=PMNBZ-F2TCU-H3AVV-4NNS2-2NGHS-OWFOZ"></script>
		<script>
            var zdId=localStorage.getItem("station_id");
			layui.use(['layer', 'form', 'table', 'util', 'admin', 'element','upload'], function() {
				var $ = layui.jquery;
				var layer = layui.layer;
				var form = layui.form;
				var table = layui.table;
				var util = layui.util;
				var admin = layui.admin;
				var element = layui.element;
				var list = [];
				
				var insTb;
                var zdId=localStorage.getItem("station_id");
				//bindnext();
				setXmnoListInit(0);
				setPbMbListInit();
				getPbData(0);
				//项目下拉监听事件
				form.on('select(project_name2List)', function(data){
					$("#project_id").val(data.value);
					var project_name=data.elem[data.elem.selectedIndex].getAttribute("project_name");
					$("#project_name").val(project_name);
					bindnext(data.value,"");
					
				})
				//配比模板监听事件
				form.on('select(pbmb)', function(data){
					//getPbData(data.value);
					//res.list[i].
				
					var project_id=data.elem[data.elem.selectedIndex].getAttribute("project_id");
					var project_name=data.elem[data.elem.selectedIndex].getAttribute("project_name");
					var qlx=data.elem[data.elem.selectedIndex].getAttribute("qlx");
					$("#project_id").val(project_id);
					$("#project_name").val(project_name);
					setXmnoListInit(project_id);
					bindnext(project_id,data.value);
					//setPbMbListInit();
				})

				var dialogIndex = '';
				

				// 配合比报告表��?
				function insReportTb(ele, lists) {

					table.render({
						elem: `#${ele}`,
						data: lists,
						height: 210,
						cols: [
							[{
									field: 'jcxm',
									align: 'center',
									edit: 'text',
									title: '检测项目',
									rowspan: 2
								},
								{
									field: 'dw',
									align: 'center',
									edit: 'text',
									title: '单位',
									rowspan: 2
								},
								{
									align: 'center',
									title: '检测结果',
									colspan: 2
								},
								{
									field: 'jsyq',
									align: 'center',
									edit: 'text',
									title: '技术要求',
									rowspan: 2
								},
								{
									align: 'center',
									title: '操作',
									rowspan: 2,
									width: 60,
									templet: function(d) {
										if (d.id === -1) {
											return '<div><i class="layui-icon text-green" id="addlist1" lay-event="add" style="cursor: pointer;">&#xe654;</i></div>'
										} else {
											return '<div><i class="layui-icon text-red" lay-event="del" style="cursor: pointer;">&#x1006;</i></div>'
										}
									}
								}
							],
							[{
									field: 'jcjg',
									align: 'center',
									edit: 'text',
									title: '检测结果'
								},
								{
									field: 'jcjg2',
									align: 'center',
									edit: 'text',
									title: '检测结果'
								},
							]
						]
					});
					table.on(`tool(${ele})`, function(obj) {
						var layEvent = obj.event;
						console.log(obj.data);
						if (layEvent === 'add') {
							lists.push({
								...obj.data,
								id: (new Date()).getTime()
							});
							let addItem = {
								id: -1,
								pb_id: '',
								jcxm: '',
								dw: '',
								jcjg: '',
								jcjg2: '',
								jsyq: '',
								type: ''
							}
							lists.splice(-2, 1);
							lists.push(addItem);
							if (ele === 'table1') {
								list1 = { ...lists
								}
							} else if (ele === 'table4') {
								list4 = { ...lists
								}
							} else if (ele === 'table5') {
								list5 = { ...lists
								}
							}
							table.reload(ele, {
								data: lists
							})
						} else if (layEvent === 'del') {
							lists.map((val, index) => {
								if (val.id === obj.data.id) {
									lists.splice(index, 1);
									if (ele === 'table1') {
										list1 = { ...lists
										}
									} else if (ele === 'table4') {
										list4 = { ...lists
										}
									} else if (ele === 'table5') {
										list5 = { ...lists
										}
									}
									table.reload(ele, {
										data: lists
									});
								}
							})
						}
					});
					table.on(`edit(${ele})`, function(obj) {
						lists.map((val, index) => {
							if (val.id === obj.data.id) {
								lists.splice(index, 1, obj.data);
								if (ele === 'table1') {
									list1 = { ...lists
									}
								} else if (ele === 'table4') {
									list4 = { ...lists
									}
								} else if (ele === 'table5') {
									list5 = { ...lists
									}
								}
							}
						});
					});
				}

				// 集料及填料基本信息表
				function insReportTbJLTL(ele, lists) {

					table.render({
						elem: `#${ele}`,
						data: lists,
						height: 210,
						cols: [
							[{
									field: 'cl',
									align: 'center',
									edit: 'text',
									title: '材料'
								},
								{
									field: 'jlgg',
									align: 'center',
									edit: 'text',
									title: '集料规格'
								},
								{
									field: 'yx',
									align: 'center',
									edit: 'text',
									title: '岩性'
								},
								{
									field: 'cd',
									align: 'center',
									edit: 'text',
									title: '产地'
								},
								{
									align: 'center',
									title: '操作',
									rowspan: 2,
									width: 60,
									templet: function(d) {
										if (d.id === -1) {
											return '<div><i class="layui-icon text-green" id="addlist1" lay-event="add" style="cursor: pointer;">&#xe654;</i></div>'
										} else {
											return '<div><i class="layui-icon text-red" lay-event="del" style="cursor: pointer;">&#x1006;</i></div>'
										}
									}
								}
							]
						]
					});
					table.on(`tool(${ele})`, function(obj) {
						var layEvent = obj.event;
						console.log(obj.data);
						if (layEvent === 'add') {
							lists.push({
								...obj.data,
								id: (new Date()).getTime()
							});
							let addItem = {
								id: -1,
								pb_id: '',
								cl: '',
								jlgg: '',
								yx: '',
								cd: ''
							}
							lists.splice(-2, 1);
							lists.push(addItem);
							list2 = { ...lists
							}
							table.reload(ele, {
								data: lists
							})
						} else if (layEvent === 'del') {
							lists.map((val, index) => {
								if (val.id === obj.data.id) {
									lists.splice(index, 1);
									list2 = { ...lists
									}
									table.reload(ele, {
										data: lists
									});
								}
							})
						}
					});
					table.on(`edit(${ele})`, function(obj) {
						lists.map((val, index) => {
							if (val.id === obj.data.id) {
								lists.splice(index, 1, obj.data);
								list2 = { ...lists
								}
							}
						});
					});
				}

				// 细集料性能指标检测结��?
				function insReportTbXJL(ele, lists) {
					table.render({
						elem: `#${ele}`,
						data: lists,
						height: 210,
						cols: [
							[{
									field: 'jcxm',
									align: 'center',
									edit: 'text',
									title: '检测项目'
								},
								{
									field: 'dw',
									align: 'center',
									edit: 'text',
									title: '单位'
								},
								{
									field: 'jcjg',
									align: 'center',
									edit: 'text',
									title: '检测结果'
								},
								{
									field: 'jsyq',
									align: 'center',
									edit: 'text',
									title: '技术要求'
								},
								{
									field: 'type',
									align: 'center',
									edit: 'text',
									title: '检测类型'
								},
								{
									align: 'center',
									title: '操作',
									rowspan: 2,
									width: 60,
									templet: function(d) {
										if (d.id === -1) {
											return '<div><i class="layui-icon text-green" id="addlist1" lay-event="add" style="cursor: pointer;">&#xe654;</i></div>'
										} else {
											return '<div><i class="layui-icon text-red" lay-event="del" style="cursor: pointer;">&#x1006;</i></div>'
										}
									}
								}
							]
						]
					});
					table.on(`tool(${ele})`, function(obj) {
						var layEvent = obj.event;
						console.log(obj.data);
						if (layEvent === 'add') {
							lists.push({
								...obj.data,
								id: (new Date()).getTime()
							});
							let addItem = {
								id: -1,
								pb_id: '',
								jcxm: '',
								dw: '',
								jcjg: '',
								jcjg2: '',
								jsyq: '',
								type: ''
							}
							lists.splice(-2, 1);
							lists.push(addItem);
							list3 = { ...lists
							}
							table.reload(ele, {
								data: lists
							})
						} else if (layEvent === 'del') {
							lists.map((val, index) => {
								if (val.id === obj.data.id) {
									lists.splice(index, 1);
									list3 = { ...lists
									}
									table.reload(ele, {
										data: lists
									});
								}
							})
						}
					});
					table.on(`edit(${ele})`, function(obj) {
						lists.map((val, index) => {
							if (val.id === obj.data.id) {
								lists.splice(index, 1, obj.data);
								list3 = { ...lists
								}
							}
						});
					});
				}

				
				
				
				
				form.on('select(sjxmList)', function(data) {
					var fx_id=$("#sjxmList").val();
					getPbData(fx_id);
				})
				
				//绑定配比数据
				function getPbData(fx_id)
				{
					
					$.get(url+"/sysProject/getProjectPb",{fx_id:fx_id},function(res){
						//debugger;
						if(res.code===0)
						{
							var data=res.data;
							if(data===null)
							{
								//$("#project_name").val("");
								$("#sjyj").val("");
								$("[name='result']").val("");
							}
							//绑定配合比报告数��?
							form.val('modelAddProjectPbForm', data);
							var projectGllqDetails =(data===null?[]:data.projectGllqDetails);
							for (var i = 0; i < projectGllqDetails.length; i++) {
								var xm = projectGllqDetails[i].syxm;
								$("#valjc" + xm).val(projectGllqDetails[i].jcjg);
								$("#valjs" + xm).val(projectGllqDetails[i].jsyq);
							}
							var list1 =(data===null?[]:data.kfProjectJcDetails);
							let addItem = {
								id: -1,
								pb_id: '',
								jcxm: '',
								dw: '',
								jcjg: '',
								jcjg2: '',
								jsyq: '',
								type: ''
							}
							list1.push(addItem);
							var list2 =(data===null?[]:data.projectJltlDetails);
							addItem = {
								id: -1,
								pb_id: '',
								cl: '',
								jlgg: '',
								yx: '',
								cd: ''
							}
							list2.push(addItem);
							var list3 =(data===null?[]:data.xjlProjectJcDetails);
							addItem = {
								id: -1,
								pb_id: '',
								jcxm: '',
								dw: '',
								jcjg: '',
								jcjg2: '',
								jsyq: '',
								type: ''
							}
							list3.push(addItem);
							var list4 =(data===null?[]:data.cjlProjectJcDetails);
							addItem = {
								id: -1,
								pb_id: '',
								jcxm: '',
								dw: '',
								jcjg: '',
								jcjg2: '',
								jsyq: '',
								type: ''
							}
							list4.push(addItem);
							var list5 =(data===null?[]:data.jlsxProjectJcDetails);
							addItem = {
								id: -1,
								pb_id: '',
								jcxm: '',
								dw: '',
								jcjg: '',
								jcjg2: '',
								jsyq: '',
								type: ''
							}
							list5.push(addItem);
						
							insReportTb('table1', list1);
							insReportTbJLTL('table2', list2);
							insReportTbXJL('table3', list3);
							insReportTb('table4', list4);
							insReportTb('table5', list5);
						}
					})
				}
				
				//保存配比数据
				$("#addpbBtn").on("click",function(){
					debugger;
					//获取高粘沥青检测指��?
					var projectGllqParams = [];
					$.each($("#GllqTable").find("tr"), function(i, item) {
						projectGllqParams[i] = {
							syxm: $(item).attr("syxm"),
							jcjg: $(item).find("#valjc" + i).val(),
							jsyq: $(item).find("#valjs" + i).val()
						}
					})
					
					//获取集料及填料基本信息表
					var projectJltlParams = [];
					var JltlTable = $("[lay-id='table2']").find(".layui-table-body").find("tr");
					for (var i = 0; i < JltlTable.length - 1; i++) {
						projectJltlParams[i] = {
							cl: $(JltlTable[i]).find("[data-field='cl']").find("div").html(),
							jlgg: $(JltlTable[i]).find("[data-field='jlgg']").find("div").html(),
							yx: $(JltlTable[i]).find("[data-field='yx']").find("div").html(),
							cd: $(JltlTable[i]).find("[data-field='cd']").find("div").html()
						}
					}
					
					//获取细集料性能指标检测结��?
					var xjlProjectJcParams = [];
					var XjlTable = $("[lay-id='table3']").find(".layui-table-body").find("tr");
					for (var i = 0; i < XjlTable.length - 1; i++) {
						xjlProjectJcParams[i] = {
							jcxm: $(XjlTable[i]).find("[data-field='jcxm']").find("div").html(),
							dw: $(XjlTable[i]).find("[data-field='dw']").find("div").html(),
							jcjg: $(XjlTable[i]).find("[data-field='jcjg']").find("div").html(),
							jsyq: $(XjlTable[i]).find("[data-field='jsyq']").find("div").html(),
							type: $(XjlTable[i]).find("[data-field='type']").find("div").html()
						}
					}
					//获取粗集料性能指标检测结��?
					var cjlProjectJcParams = [];
					var CljTable = $("[lay-id='table4']").find(".layui-table-body").find("tr");
					for (var i = 0; i < XjlTable.length - 1; i++) {
						cjlProjectJcParams[i] = {
							jcxm: $(CljTable[i]).find("[data-field='jcxm']").find("div").html(),
							dw: $(CljTable[i]).find("[data-field='dw']").find("div").html(),
							jcjg: $(CljTable[i]).find("[data-field='jcjg']").find("div").html(),
							jcjg2: $(CljTable[i]).find("[data-field='jcjg2']").find("div").html(),
							jsyq: $(CljTable[i]).find("[data-field='jsyq']").find("div").html()
						}
					}
					
					//获取矿粉性能检测结��?
					var kfProjectJcParams = [];
					var KfTable = $("[lay-id='table1']").find(".layui-table-body").find("tr");
					for (var i = 0; i < XjlTable.length - 1; i++) {
						kfProjectJcParams[i] = {
							jcxm: $(KfTable[i]).find("[data-field='jcxm']").find("div").html(),
							dw: $(KfTable[i]).find("[data-field='dw']").find("div").html(),
							jcjg: $(KfTable[i]).find("[data-field='jcjg']").find("div").html(),
							jcjg2: $(KfTable[i]).find("[data-field='jcjg2']").find("div").html(),
							jsyq: $(KfTable[i]).find("[data-field='jsyq']").find("div").html()
						}
					}
					//获取集料筛选结��?
					var jlsxProjectJcParams = [];
					var JlsxTable = $("[lay-id='table5']").find(".layui-table-body").find("tr");
					for (var i = 0; i < XjlTable.length - 1; i++) {
						jlsxProjectJcParams[i] = {
							jcxm: $(JlsxTable[i]).find("[data-field='jcxm']").find("div").html(),
							dw: $(JlsxTable[i]).find("[data-field='dw']").find("div").html(),
							jcjg: $(JlsxTable[i]).find("[data-field='jcjg']").find("div").html(),
							jcjg2: $(JlsxTable[i]).find("[data-field='jcjg2']").find("div").html(),
							jsyq: $(JlsxTable[i]).find("[data-field='jsyq']").find("div").html()
						}
					}
					
					var projectPbParam = {
						pb_id: 0,
						project_id: $("#project_id").val(),
						project_name: $("#project_name").val(),
						sjxm: $("#sjxmList").val(),
						sjyj: $("#sjyj").val(),
						projectGllqParams: projectGllqParams,
						projectJltlParams: projectJltlParams,
						xjlProjectJcParams: xjlProjectJcParams,
						cjlProjectJcParams: cjlProjectJcParams,
						kfProjectJcParams: kfProjectJcParams,
						jlsxProjectJcParams: jlsxProjectJcParams
					};
					$.ajax({
						type: "post",
						url: url + '/sysProject/addPb',
						data: JSON.stringify(projectPbParam),
						contentType: 'application/json;utf-8',
						dataType: "json",
						success: function(res) {
							layer.closeAll('loading');
							if (res.code == 0) {
								layer.msg('保存成功', {
									icon: 1
								});
							} else {
								layer.msg(res.msg, {
									icon: 2
								});
							}
						}
					})
				})
				
				//设置配比报告模板
				function setPbMbListInit(){
					$.ajax({
					    type: "get",
					    url: url + '/sysProject/getPbMould',
						data:{idzhandian:localStorage.getItem("station_id")},
						//data:{},
					    success: function(res) {
							var str="";
					        for (var i = 0; i < res.list.length; i++) {
								
								str += '<option value=' + res.list[i].fx_id + ' project_name='+res.list[i].project_name+' project_id='+res.list[i].project_id+' qlx='+res.list[i].qlx+'>' + res.list[i].project_name + ' '+res.list[i].qlx + '</option>';
					        }
					        str = '<option value="">请选择</option>' + str;
					        console.log(str);
					        $('#pbmb').html(str);
					         layui.form.render("select");
					    }
					});
				}
				//设置项目下拉
				function setXmnoListInit(project_id){
					$.ajax({
					    type: "get",
					    url: url + '/production/getProjectList',
						data:{"idzhandian":localStorage.getItem("station_id")},
					    success: function(res) {
							var str="";
					        for (var i = 0; i < res.length; i++) {
								
								// if(projectId==res[i].project_id){
								// 	str += '<option  selected="selected" value=' + res[i].project_id + ' custom_name="'+custom_name+'" project_name="'+res[i].project_name+'" project_address="'+project_address+'" gzlxr="'+gzlxr+'" gdlxdh="'+gdlxdh+'" sgdw="'+sgdw+'">' + res[i].project_no + ' '+res[i].project_name + '</option>'
								// }else{
								// 	str += '<option value=' + res[i].project_id + ' custom_name="'+custom_name+'" project_name="'+res[i].project_name+'" project_address="'+project_address+'" gzlxr="'+gzlxr+'" gdlxdh="'+gdlxdh+'" sgdw="'+sgdw+'">' + res[i].project_no + ' '+res[i].project_name + '</option>'
								// }
								if(project_id==res[i].project_id){
									str += `<option selected="selected" value="${res[i].project_id}">${res[i].project_no + ' ' + res[i].project_name}</option>`;
								}else{
									str +=  `<option value="${res[i].project_id}" project_name="${res[i].project_name}">${res[i].project_no+' '+res[i].project_name}</option>`				           
								}
								
					        }
					        str = '<option value="">请选择</option>' + str;
					        console.log(str);
					        $('#project_name2List').html(str);
					          layui.form.render("select");
					    }
					});
				}
				
				
				//绑定下一步数据
				function bindnext(project_id,qlx)
				{
					$.get(url+"/sysProject/getProjectFx",{projectId:project_id},function(res){
						if(res.code===0)
						{
							var html="";
							$.each(res.list,function(i,item){
								if(qlx==item.fx_id){
									html+='<option selected="selected" value="'+item.fx_id+'">'+item.qlx+'</option>';
								}else{
									html+='<option value="'+item.fx_id+'">'+item.qlx+'</option>';
								}
								
							})
							$("#sjxmList").html(html);
							layui.form.render("select");
							var fx_id=$("#sjxmList").val();
							getPbData(fx_id);
						}
					})
				}
				
				
			});
			
			
		</script>

	</body>
</html>
