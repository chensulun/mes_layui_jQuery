<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>资产管理</title>
		<link rel="stylesheet" href="../../assets/libs/layui/css/layui.css" />
		<link rel="stylesheet" href="../../assets/module/admin.css?v=314" />
		<link rel="stylesheet" href="../../assets/css/common_likui.css?v=314" />
		<link rel="stylesheet" href="../../assets/module/formSelects/formSelects-v4.css" />
		<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
		<style>
			.search-container {
            height: 204px;
            padding: 25px 0 30px 80px;
            box-sizing: border-box;
        }
        .search-container .layui-form-radio {
            margin: 0 30px 0 0 ;
        }
        .project-setting-table {
            padding: 30px 20px;
        }
        .layui-table, .layui-table-view {
            margin: 0;
        }
        #erweicode {
            width: 150px;
            height: 150px;
            border: 1px solid #eee;
            margin: 0 auto;
            padding: 10px;
            box-sizing: border-box;
        }
		.supply-img-container {
		
		}
		.supply-img-item {
		    width: 96px;
		    height: 96px;
		    border: 1px solid #eee;
		    border-radius: 6px;
		    margin-right: 20px;
		    position: relative;
		}
		.supply-img-item .supply-img-close {
		    width: 13px;
		    height: 13px;
		    cursor: pointer;
		    position: absolute;
		    top: -6px;
		    right: -6px;
		    border-radius: 50%;
		    border: 1px solid rgba(255, 0, 0, 1);
		    font-size: 10px;
		    text-align: center;
		    color: rgba(255, 0, 0, 1);
		}
		.supply-img-item img {width: 100%;}
		#contract-upload {
			width: 98px;
			height: 98px;
			border: 1px solid #eee;
			border-radius: 4px;
			text-align: center;
			font-size: 12px;
			padding: 24px 0;
			color: #999;
			cursor: pointer;
			box-sizing: border-box;
			display: inline-block;
			vertical-align: top;
		}
    </style>
	</head>
	<body>

		<!-- 页面加载loading -->
		<div class="page-loading">
			<div class="ball-loader">
				<span></span><span></span><span></span><span></span>
			</div>
		</div>

		<!-- 正文开始 -->
		<div class="layui-fluid">
			<div class="layui-card" style="background-color: initial;">
				<div class="layui-card-body">
					<div class="layui-form toolbar">
						<div class="layui-form-item">
							<div class="search-container bg-white">
								<div class="clear">
									<label class="layui-form-label w-auto">日期：</label>
									<div class="layui-input-inline" style="width: 200px;">
										<input type="text" name="taskStartTime" class="layui-input" id="test-laydate-start" placeholder="开始日期"
										 lay-key="1">
									</div>
									<div class="layui-form-mid"> - </div>
									<div class="layui-input-inline" style="width: 200px;">
										<input type="text" name="taskEndTime" class="layui-input" id="test-laydate-end" placeholder="结束日期" lay-key="2">
									</div>
								</div>
								<div class="mt-20">
									<div class="layui-inline" style="width: 300px;">
										<label class="layui-form-label w-auto">类别：</label>
										<div class="layui-input-inline" style="width: 200px;">
											<select id="type" name="type" lay-filter="type" lay-verType="tips" lay-verify="required">
											</select>
										</div>
									</div>
									<div class="layui-inline" style="width: 300px;">
										<label class="layui-form-label w-auto">状态：</label>
										<div class="layui-input-inline" style="width: 200px;">
											<select name="status" id="status">
												<option value=""> 请选择</option>
												<option value="使用中">使用中</option>
												<option value="报废">报废</option>
												<option value="封存">封存</option>
											</select>
										</div>
									</div>
									<div class="layui-inline" style="width: 300px;">
										<label class="layui-form-label w-auto">管理人：</label>
										<div class="layui-input-inline" style="width: 200px;">
											<select id="userList" name="userList" lay-filter="userList" lay-verType="tips" lay-verify="required">
											</select>
										</div>
									</div>
								</div>
								<div class="mt-20" style="text-align:center;">
									<div class="layui-inline">
										<div class="layui-inline">
											<button id="btnSearch" class="layui-btn layui-btn-green3" style="margin-left: 30px;">查询</button>
										</div>
										<div class="layui-inline">
											<a id="btnAddProperty" class="layui-btn layui-btn-red" style="margin-left: 30px;">新增</a>
										</div>
										<div class="layui-inline">
											<a id="btnAddAssetsType" class="layui-btn layui-btn-red" style="margin-left: 30px;">新增类别</a>
										</div>
										<div class="layui-inline">
											<a id="btnAddAssetscl" class="layui-btn layui-btn-red" style="margin-left: 30px;">新增构件库</a>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="project-setting-table bg-white mt-20">
						<div class="layui-tab layui-tab-brief" lay-filter="projectSetting">
							<ul class="layui-tab-title">
								<li class="layui-this">设备信息</li>
								<li>设备类别</li>
								<li>构件库</li>
							</ul>
							<div class="layui-tab-content">
								<div class="layui-tab-item layui-show">
									<table class="layui-table" id="tableProperty" lay-filter="tableProject"></table>
								</div>
								<div class="layui-tab-item">
									<table class="layui-table" id="tablePropertyType" lay-filter="tableCustomer"></table>
								</div>
								<div class="layui-tab-item">
									<table class="layui-table" id="tablePropertycl" lay-filter="tableAssetscl"></table>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>

		<!-- 表格操作列 -->
		<script type="text/html" id="tableBarProperty">
			<a class="layui-btn layui-btn-xs table-btn btn-look" lay-event="look"><span class="btn-icon"></span>查看</a>
		    <a class="layui-btn layui-btn-xs table-btn btn-edit" lay-event="edit"><span class="btn-icon"></span>修改</a>
		    <a class="layui-btn layui-btn-xs table-btn btn-del" lay-event="del"><span class="btn-icon"></span>删除</a>
		</script>
		<script type="text/html" id="tableBarPropertyType">
			<a class="layui-btn layui-btn-xs table-btn btn-look" lay-event="typelook"><span class="btn-icon"></span>查看</a>
		    <a class="layui-btn layui-btn-xs table-btn btn-edit" lay-event="typeedit"><span class="btn-icon"></span>修改</a>
		    <a class="layui-btn layui-btn-xs table-btn btn-del" lay-event="typedel"><span class="btn-icon"></span>删除</a>
		</script>
		<script type="text/html" id="tableBarPropertycl">
			<a class="layui-btn layui-btn-xs table-btn btn-look" lay-event="cllook"><span class="btn-icon"></span>查看</a>
		    <a class="layui-btn layui-btn-xs table-btn btn-edit" lay-event="cledit"><span class="btn-icon"></span>修改</a>
		    <a class="layui-btn layui-btn-xs table-btn btn-edit" lay-event="clrkedit"><span class="btn-icon"></span>入库</a>
		    <a class="layui-btn layui-btn-xs table-btn btn-del" lay-event="cldel"><span class="btn-icon"></span>删除</a>
		</script>
		<!--新增设备类别-->
		<script type="text/html" id="modelAssetsType">
			<form id="modelAssetsTypeForm" lay-filter="modelAssetsTypeForm" class="layui-form model-form">
			<div class="layui-form-item layui-row">
				<div class="layui-col-md12">
				    <label class="layui-form-label">设备类别</label>
				    <div class="layui-input-block">
						<input type="hidden" id="AssetsTypeid" />
				        <input name="AssetsTypename" id="AssetsTypename" placeholder="请输入设备类别" type="text" class="layui-input"
				               lay-verType="tips" lay-verify="required" required/>
				    </div>
				</div>
		        <div class="layui-form-item text-center p-30">
		            <button class="layui-btn layui-btn-primary mr-10" type="button" lay-filter="modelSubmitAddAssetsType" lay-submit>保存</button>
		            <button class="layui-btn" type="button" ew-event="closePageDialog">取消</button>
		        </div>
			</div>
			</form>
		</script>
		<!--新增构件库-->
		<script type="text/html" id="modelAssetscl">
			<form id="modelAssetsclForm" lay-filter="modelAssetsclForm" class="layui-form model-form">
			<div class="layui-form-item layui-row">
				<div class="layui-col-md12">
				    <label class="layui-form-label">构件库名称</label>
				    <div class="layui-input-block">
						<input type="hidden" id="Assetsclid" />
				        <input name="clname" id="clname" placeholder="请输入构件库名称" type="text" class="layui-input"
				               lay-verType="tips" lay-verify="required" required/>
				    </div>
				</div>
		        <div class="layui-form-item text-center p-30">
		            <button class="layui-btn layui-btn-primary mr-10" type="button" lay-filter="modelSubmitAddAssetscl" lay-submit>保存</button>
		            <button class="layui-btn" type="button" ew-event="closePageDialog">取消</button>
		        </div>
			</div>
			</form>
		</script>
		<!--修改入库参数-->
		<script type="text/html" id="modelAssetsclrk">
			<form id="modelAssetsclrkForm" lay-filter="modelAssetsclrkForm" class="layui-form model-form">
			<div class="layui-form-item layui-row">
				<div class="layui-col-md12">
				    <label class="layui-form-label">入库位置</label>
				    <div class="layui-input-block">
						<input type="hidden" id="Assetsclid" />
				        <input name="clname" id="clname" placeholder="请输入入库位置" type="text" class="layui-input"
				               lay-verType="tips" lay-verify="required" required/>
				    </div>
				</div>
				<div class="layui-col-md12">
				    <label class="layui-form-label">入库人员</label>
				    <div class="layui-input-block">
				        <input name="clname" id="clname" placeholder="请输入入库人员" type="text" class="layui-input"
				               lay-verType="tips" lay-verify="required" required/>
				    </div>
				</div>
				<div class="layui-col-md12">
				    <label class="layui-form-label">入库单价</label>
				    <div class="layui-input-block">
				        <input name="clname" id="clname" placeholder="请输入构入库单价" type="text" class="layui-input"
				               lay-verType="tips" lay-verify="required" required/>
				    </div>
				</div>
				<div class="layui-col-md12">
				    <label class="layui-form-label">入库数量</label>
				    <div class="layui-input-block">
				        <input name="clname" id="clname" placeholder="请输入入库数量" type="text" class="layui-input"
				               lay-verType="tips" lay-verify="required" required/>
				    </div>
				</div>
		        <div class="layui-form-item text-center p-30">
		            <button class="layui-btn layui-btn-primary mr-10" type="button" lay-filter="modelSubmitAddAssetsclrk" lay-submit>保存</button>
		            <button class="layui-btn" type="button" ew-event="closePageDialog">取消</button>
		        </div>
			</div>
			</form>
		</script>
		<!-- 弹窗-新增编辑客户 -->
		<script type="text/html" id="modelProperty">
			<form id="modelAssetsForm" lay-filter="modelAssetsForm" class="layui-form model-form">
		        <div class="layui-form-item layui-row">
				<input type="hidden" id="id" />
		            <div class="layui-col-md6">
		                <label class="layui-form-label">设备编号</label>
		                <div class="layui-input-block">
		                    <input id="assetscode" name="assetscode" placeholder="请输入设备编号" type="text" class="layui-input"
		                           lay-verType="tips" lay-verify="required" required/>
		                </div>
		            </div>
		            <div class="layui-col-md6">
		                <label class="layui-form-label">设备类别</label>
		                <div class="layui-input-block">
		                    <select id="lblist" name="lblist" lay-verType="tips" lay-verify="required">
		                    </select>
		                </div>
		            </div>
					</div>
		        <div class="layui-form-item layui-row">
		            <div class="layui-col-md6">
		                <label class="layui-form-label">资产名称</label>
		                <div class="layui-input-block">
		                    <input id="assetsname" name="assetsname" placeholder="请输入资产名称" type="text" class="layui-input"
		                           lay-verType="tips" lay-verify="required" required/>
		                </div>
		            </div>
		            <div class="layui-col-md6">
		                <label class="layui-form-label">构件库名称</label>
		                <div class="layui-input-block">
		                    <select id="cllist" xm-select="cllist"  name="cllist" lay-verify="required" multiple lay-omit>
		                    </select>
		                </div>
		            </div>
					</div>
		        <div class="layui-form-item layui-row">
		            <div class="layui-col-md6">
		                <label class="layui-form-label">制造商</label>
		                <div class="layui-input-block">
		                    <input id="assetsmaker"  name="assetsmaker" placeholder="请输入制造商" type="text" class="layui-input"
		                           lay-verType="tips" lay-verify="required" required/>
		                </div>
		            </div>
		            <div class="layui-col-md6">
		                <label class="layui-form-label">状态</label>
		                <div class="layui-input-block">
		                   <select id="assetsstatus" name="assetsstatus" lay-verType="tips" lay-verify="required">
		                	<option value="使用中">使用中</option>
		                	<option value="报废">报废</option>
		                	<option value="封存">封存</option>
		                   </select>
		                </div>
		            </div>
					</div>
		        <div class="layui-form-item layui-row">
		            <div class="layui-col-md6">
		                <label class="layui-form-label">责任人</label>
		                <div class="layui-input-block">
		                    <select id="zrrlist" name="zrrlist" lay-verType="tips" lay-verify="required">
		                    </select>
		                </div>
		            </div>
					</div>
		        <div class="layui-form-item layui-row">
		            <div class="layui-col-md6">
		                <label class="layui-form-label">采购时间</label>
		                <div class="layui-input-block">
		                    <input type="text" name="cg_date" id="cg_date" placeholder="请选择采购时间" class="layui-input" lay-verType="tips" lay-verify="required" autocomplete="off" />
		                </div>
		            </div>
		            <div class="layui-col-md6">
		                <label class="layui-form-label">入库时间</label>
		                <div class="layui-input-block">
		                   <input type="text" name="rk_date" id="rk_date" placeholder="请选中入库时间" class="layui-input" lay-verType="tips" lay-verify="required" autocomplete="off" />
		                </div>
		            </div>
					</div>
		        <div class="layui-form-item layui-row">
		            <div class="layui-col-md12">
		                <label class="layui-form-label">存储位置</label>
		                <div class="layui-input-block">
		                    <input id="storagelocation" name="storagelocation" placeholder="请输入存储位置" type="text" class="layui-input"
		                           lay-verType="tips" lay-verify="required" required/>
		                </div>
		            </div>
		        </div>
				<div class="layui-form-item layui-row">
				    <div class="layui-col-md12">
				        <label class="layui-form-label">MAC地址</label>
				        <div class="layui-input-block">
				            <input id="mac" name="mac" placeholder="请输入MAC地址" type="text" class="layui-input"
				                   lay-verType="tips" lay-verify="required" required/>
				        </div>
				    </div>
				</div>
		        <div class="layui-form-item layui-row">
		            <div class="layui-col-md12">
						<label class="layui-form-label">上传语音或视频:</label>
						<div class="layui-input-block" style="margin-bottom: 0px;">
							<ul id="ulfile_0" class="layui-block clear supply-img-container"></ul>
							<input type="file" id="contract-uploadfile0" name="file" />
						</div>
					</div>
		        </div>
					<div id="erweicode"></div>
		        <div class="layui-form-item text-center p-30">
		            <button class="layui-btn layui-btn-primary mr-10" type="button" lay-filter="modelSubmitAddCustomer" lay-submit>保存</button>
		            <button class="layui-btn" type="button" ew-event="closePageDialog">取消</button>
		        </div>
		    </form>
		</script>
		<!-- 弹窗-查看客户 -->
		<script type="text/html" id="modelProperty1">
			<form id="modelPropertyForm1" lay-filter="modelPropertyForm1" class="layui-form model-form">
		        <div class="layui-form-item layui-row">
		            <div class="layui-col-md4">
		                <label class="layui-form-label">资产名称</label>
		                <div class="layui-input-block">
		                    <input name="assetsname" placeholder="资产名称" type="text" class="layui-input"
		                           lay-verType="tips" lay-verify="required" required disabled="disabled" />
		                </div>
		            </div>
		            <div class="layui-col-md4">
						    <label class="layui-form-label">编号</label>
						    <div class="layui-input-block">
						        <input name="assetscode" placeholder="编号" type="text" class="layui-input"
						               lay-verType="tips" lay-verify="required" required disabled="disabled" />
						    </div>
		            </div>
		            <div class="layui-col-md4 text-center">
		                <button id="downloadImg" type="button" class="layui-btn layui-btn-green">下载</button>
		                <button id="printImg" type="button" class="layui-btn layui-btn-green">打印</button>
		            </div>
		            <div class="layui-col-md4 mt-20">
						<div >
						    <label class="layui-form-label">设备类别</label>
						    <div class="layui-input-block">
						        <input name="assetstypename" placeholder="类别" type="text" class="layui-input"
						               lay-verType="tips" lay-verify="required" required disabled="disabled" />
						    </div>
						</div>
		                <div class="mt-20">
		                    <label class="layui-form-label">状态</label>
		                    <div class="layui-input-block">
		                        <input name="assetsstatus" placeholder="状态" type="text" class="layui-input"
		                               lay-verType="tips" lay-verify="required" required disabled="disabled" />
		                    </div>
		                </div>
		                <div class="mt-20">
		                    <label class="layui-form-label">采购时间</label>
		                    <div class="layui-input-block">
		                        <input name="cg_date" placeholder="采购时间" type="text" class="layui-input"
		                               lay-verType="tips" lay-verify="required" required disabled="disabled" />
		                    </div>
		                </div>
		                <div class="mt-20">
		                    <label class="layui-form-label">存储位置</label>
		                    <div class="layui-input-block">
		                        <input name="storagelocation" placeholder="存储位置" type="text" class="layui-input"
		                               lay-verType="tips" lay-verify="required" required disabled="disabled" />
		                    </div>
		                </div>
						<div class="mt-20">
						    <label class="layui-form-label">MAC地址</label>
						    <div class="layui-input-block">
						        <input name="mac" placeholder="MAC地址" type="text" class="layui-input"
						               lay-verType="tips" lay-verify="required" required disabled="disabled" />
						    </div>
						</div>
		            </div>
		            <div class="layui-col-md4 mt-20">
		                <div>
		                    <label class="layui-form-label">构件库</label>
		                    <div class="layui-input-block">
		                        <input name="assetsclname" placeholder="构件库" type="text" class="layui-input"disabled="disabled" />
		                    </div>
		                </div>
		                <div class="mt-20">
		                    <label class="layui-form-label">制造商</label>
		                    <div class="layui-input-block">
		                        <input name="assetsmaker" placeholder="制造商" type="text" class="layui-input"
		                               lay-verType="tips" lay-verify="required" required disabled="disabled" />
		                    </div>
		                </div>
		                <div class="mt-20">
		                    <label class="layui-form-label">入库时间</label>
		                    <div class="layui-input-block">
								<input type="text" name="rk_date" class="layui-input" placeholder="入库时间" lay-verType="tips" lay-verify="required" required disabled="disabled" />
																				
		                    </div>
		                </div>
		                <div class="mt-20">
		                    <label class="layui-form-label">责任人</label>
		                    <div class="layui-input-block">
		                        <input name="user_name" placeholder="责任人" type="text" class="layui-input"
		                               lay-verType="tips" lay-verify="required" required disabled="disabled" />
		                    </div>
		                </div>
		            </div>
		            <div class="layui-col-md4 mt-20">
		                <div id="erweicode"></div>
		            </div>

		        </div>
		        <div class="layui-form-item text-center p-30">
		            <button class="layui-btn" type="button" ew-event="closePageDialog">取消</button>
		        </div>
		    </form>
		</script>
		<!-- js部分 -->
		<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
		<script type="text/javascript" src="../../assets/js/common.js?v=314"></script>
		<script type="text/javascript" src="../../assets/libs/jquery/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="../../assets/js/jquery.qrcode.min.js"></script>
		<script type="text/javascript" src="../../assets/js/jQuery.print.min.js"></script>
		<script>
			layui.use(['layer', 'form', 'table', 'util', 'laydate', 'admin', 'element', 'upload', 'formSelects'], function() {
				var $ = layui.jquery;
				var layer = layui.layer;
				var form = layui.form;
				var table = layui.table;
				var util = layui.util;
				var laydate = layui.laydate;
				var admin = layui.admin;
				var upload = layui.upload;
				var element = layui.element;
				var formSelects = layui.formSelects;
				var insTb = table.render({
					elem: '#tableProperty',
					url: url + '/zichan/getassetsList',
					page: true,
					cellMinWidth: 100,
					cols: [
						[
							// {type: 'numbers', title: '序号'},
							{
								field: 'assetsname',
								align: 'center',
								title: '资产名称'
							},
							{
								field: 'assetsclname',
								align: 'center',
								title: '构件库'
							},
							{
								field: 'assetsmaker',
								align: 'center',
								title: '制造商'
							},
							{
								field: 'assetstypename',
								align: 'center',
								title: '设备类别'
							},
							{
								field: 'assetscode',
								align: 'center',
								title: '编号'
							},
							{
								field: 'storagelocation',
								align: 'center',
								title: '存储位置'
							},
							{
								field: 'assetsstatus',
								align: 'center',
								title: '状态'
							},
							{
								field: 'cg_date',
								align: 'center',
								title: '采购时间'
							},
							{
								field: 'rk_date',
								align: 'center',
								title: '入库时间'
							},
							{
								field: 'create_date',
								align: 'center',
								title: '更新时间'
							},
							{
								field: 'user_name',
								align: 'center',
								title: '管理人'
							},
							{
								field: 'mac',
								align: 'center',
								title: 'MAC地址'
							},
							{
								align: 'center',
								toolbar: '#tableBarProperty',
								title: '操作',
								minWidth: 200,
								fixed: 'right'
							}
						]
					],
					request: {
						pageName: 'pageIndex', //页码的参数名称，默认：page
						limitName: 'pageSize' //每页数据量的参数名，默认：limit
					},
					where: {
						bg_time: $('#test-laydate-start').val(),
						ed_time: $('#test-laydate-end').val(),
						gl_person: $('#userList option:selected').text(),
						status: $("#status").val(),
						type: $("#type").val(),
						zhandian_id: localStorage.getItem("station_id")
					},
					response: {
						countName: 'totalCount', //数据总数的字段名称，默认：count
						dataName: 'list' //数据列表的字段名称，默认：data
					}
				});
				var insTb1 = table.render({
					elem: '#tablePropertyType',
					url: url + '/zichan/getAssetsTypeList',
					page: true,
					cellMinWidth: 100,
					cols: [
						[{
								field: 'typename',
								align: 'center',
								title: '类别名称'
							},
							{
								field: 'create_date',
								align: 'center',
								title: '创建时间'
							},
							{
								align: 'center',
								toolbar: '#tableBarPropertyType',
								title: '操作',
								minWidth: 200,
								fixed: 'right'
							}
						]
					],
					request: {
						pageName: 'pageIndex', //页码的参数名称，默认：page
						limitName: 'pageSize' //每页数据量的参数名，默认：limit
					},
					where: {
						zhandian_id: localStorage.getItem("station_id")
					},
					response: {
						countName: 'totalCount', //数据总数的字段名称，默认：count
						dataName: 'list' //数据列表的字段名称，默认：data
					}
				});
				var insTb2 = table.render({
					elem: '#tablePropertycl',
					url: url + '/zichan/getAssetsclList',
					page: true,
					cellMinWidth: 100,
					cols: [
						[{
								field: 'clname',
								align: 'center',
								title: '构件库名称'
							},
							{
								field: 'create_date',
								align: 'center',
								title: '创建时间'
							},
							{
								align: 'center',
								toolbar: '#tableBarPropertycl',
								title: '操作',
								minWidth: 300,
								fixed: 'right'
							}
						]
					],
					request: {
						pageName: 'pageIndex', //页码的参数名称，默认：page
						limitName: 'pageSize' //每页数据量的参数名，默认：limit
					},
					where: {
						zhandian_id: localStorage.getItem("station_id"),
						assetstype_id: ''
					},
					response: {
						countName: 'totalCount', //数据总数的字段名称，默认：count
						dataName: 'list' //数据列表的字段名称，默认：data
					}
				});

				//查询
				$('#btnSearch').on('click', (e) => {
					insTb.reload({
						where: {
							bg_time: $('#test-laydate-start').val(),
							ed_time: $('#test-laydate-end').val(),
							gl_person: $('#userList option:selected').text()=="请选择"?"":$('#userList option:selected').text(),
							status: $("#status").val(),
							type: $("#type").val(),
							zhandian_id: localStorage.getItem("station_id")
						},
						page: {
							curr: 1
						}
					});
				});
				bindtype();
				bindcl();
				bindUser();
				function getuploadfile(id) {
					// 上传头像
					var insUpload = upload.render({
						elem: '#contract-uploadfile' + id, //绑定元素
						url: url + '/upload/file', //上传接口
						accept: 'file', //普通文件
						done: function(res) {
							$("#ulfile_" + id).empty();
							console.log(res)
							//上传完毕回调
							headFile = res.data.filePath;
							//alert("图片上传成功，路劲为：" + headFile);
							var append = '<li><input type="hidden" name="file_url" value="' + headFile +
								'"/><label>' + headFile +
								'</label></li>';
							$("#ulfile_" + id).append(append);
						},
						error: function() {
							//请求异常回调
						}
					});
				}
				//绑定类别
				function bindcl() {
					$.ajax({
						url: url + '/zichan/getAssetsclList',
						type: 'get',
						data: {
							'zhandian_id': localStorage.getItem("station_id"),
							'assetstype_id': '',
							'pageIndex': 1,
							'pageSize': 9999
						},
						async: false,
						success: function(res) {
							debugger;
							var data = res.list;
							var jsonarray = [];

							$.each(data, function(i, v) {
								var arr = {
									"value": v.id,
									"name": v.clname
								}
								//把创建的arr添加进事先定义的jsonarray
								jsonarray.push(arr);
							})
							//$("#cllist").html(html);
							layui.formSelects.data('cllist', 'local', {
								arr: jsonarray
							});
							layui.form.render("select");
						}
					})
				}
				//绑定类别
				function bindtype() {
					$.ajax({
						url: url + '/zichan/getAssetsTypeList',
						type: 'get',
						data: {
							'zhandian_id': localStorage.getItem("station_id"),
							'pageIndex': 1,
							'pageSize': 9999
						},
						async: false,
						success: function(res) {
							var data = res.list;
							var html = '<option value="">请选择</option>';
							$.each(data, function() {
								html += '<option value="' + this.id + '">' + this.typename + '</option>';
							})
							$("#type").html(html);
							$("#lblist").html(html);
							layui.form.render("select");
						}
					})
				}

				function bindUser() {
					$.ajax({
						url: url + '/shebei/getuserlist',
						type: 'get',
						data: {
							'userName': ""
						},
						async: false,
						success: function(res) {
							var html = '<option value="">请选择</option>';
							$.each(res, function() {
								html += '<option value="' + this.userid + '">' + this.realName + '</option>';
							})
							$("#userList").html(html);
							$("#zrrlist").html(html);
							layui.form.render("select");
						}
					})
				}
				//日期
				laydate.render({
					elem: '#test-laydate-start',
					trigger: 'click',
					format: 'yyyy-MM-dd',
					done: function(value, date, endDate) {
						var startDate = new Date(value).getTime();
						var endTime = new Date($('#test-laydate-end').val()).getTime();
						if (endTime < startDate) {
							layer.msg('开始时间不能大于结束时间');
							$('#test-laydate-start').val($('#test-laydate-end').val());
						}
					}

				});
				laydate.render({
					elem: '#test-laydate-end',
					trigger: 'click',
					format: 'yyyy-MM-dd',
					done: function(value, date, endDate) {
						var startDate = new Date($('#test-laydate-start').val()).getTime();
						var endTime = new Date(value).getTime();
						if (endTime < startDate) {
							layer.msg('结束时间不能小于开始时间');
							$('#test-laydate-end').val($('#test-laydate-start').val());
						}
					}
				});
				$('#btnAddProperty').on('click', () => {
					showEditModel("添加");
				});
				$('#btnAddAssetsType').on('click', () => {
					showTypeEditModel("添加");
				});
				$('#btnAddAssetscl').on('click', () => {
					showclEditModel("添加");
				});
				//客户操作
				table.on('tool(tableProject)', function(obj) {
					var data = obj.data;
					console.log(data);
					var layEvent = obj.event;
					if (layEvent === 'del') {
						layer.confirm('确定要删除资产“' + data.assetsname + '”吗？', {
							skin: 'layui-layer-admin',
							shade: .1
						}, function(i) {
							layer.close(i);
							layer.load(2);
							$.post(url + '/shebei/delete', {
								id: data.id,
								table_name: 'zichan_assets'
							}, function(res) {
								layer.closeAll('loading');
								if (res.code == 0) {
									layer.msg(res.msg, {
										icon: 1
									});
									insTb.reload();
								} else {
									layer.msg(res.msg, {
										icon: 2
									});
								}
							}, 'json');
						});
					} else if (layEvent === 'edit') {
						showEditModel(data);
					} else if (layEvent === 'look') {
						showDetailModel(data);
					}
				});
				//设备类别
				table.on('tool(tableCustomer)', function(obj) {
					var data = obj.data;
					console.log(data);
					var layEvent = obj.event;
					if (layEvent === 'typedel') {
						layer.confirm('确定要删除资产类别“' + data.typename + '”吗？', {
							skin: 'layui-layer-admin',
							shade: .1
						}, function(i) {
							layer.close(i);
							layer.load(2);
							$.post(url + '/shebei/delete', {
								id: data.id,
								table_name: 'zichan_assets_type'
							}, function(res) {
								layer.closeAll('loading');
								if (res.code == 0) {
									layer.msg(res.msg, {
										icon: 1
									});
									insTb1.reload();
								} else {
									layer.msg(res.msg, {
										icon: 2
									});
								}
							}, 'json');
						});
					} else if (layEvent === 'typeedit') {
						showTypeEditModel(data);
					} else if (layEvent === 'typelook') {
						showTypeEditModel(data);
					}
				});
				//设备类别
				table.on('tool(tableAssetscl)', function(obj) {
					var data = obj.data;
					console.log(data);
					var layEvent = obj.event;
					if (layEvent === 'cldel') {
						layer.confirm('确定要删除资产构件库“' + data.clname + '”吗？', {
							skin: 'layui-layer-admin',
							shade: .1
						}, function(i) {
							layer.close(i);
							layer.load(2);
							$.post(url + '/shebei/delete', {
								id: data.id,
								table_name: 'zichan_assets_cl'
							}, function(res) {
								layer.closeAll('loading');
								if (res.code == 0) {
									layer.msg(res.msg, {
										icon: 1
									});
									insTb2.reload();
								} else {
									layer.msg(res.msg, {
										icon: 2
									});
								}
							}, 'json');
						});
					} else if (layEvent === 'cledit') {
						showclEditModel(data);
					} else if (layEvent === 'clrkedit') {
						showclrkEditModel(data);
					} else if (layEvent === 'cllook') {
						showclEditModel(data);
					}
				});

				function bindImgList(mUser) {
					$.ajax({
						url: url + '/shebei/getassetsDetails',
						type: 'get',
						async: false,
						data: {
							id: mUser.id
						},
						success: function(res) {
							if (res.code == 0) {
								var html = '';
								$.each(res.data.img_list, function() {
									html += '<li img_url="' + this.img_url +
										'" class="pull-left supply-img-item"><img src="' + imgUrl + this.img_url +
										'"><i   class="supply-img-close  layui-icon" onclick="getdeleteImg(this)">&#x1006;</i></li>';
								})
								$("#img_list").html(html);
							}
						}
					})
				}
				// 查看弹窗
				function showDetailModel(mUser) {
					admin.open({
						type: 1,
						area: '960px',
						title: '查看',
						content: $('#modelProperty1').html(),
						success: function(layero, dIndex) {
							$("#assetsstatus").val(mUser.assetsstatus);
							//layui.form.render("select");
							form.val('modelPropertyForm1', mUser);
							//执行一个laydate实例
							// laydate.render({
							// 	elem: '#cg_date' //指定元素
							// });
							// laydate.render({
							// 	elem: '#rk_date' //指定元素
							// });
							// 生成二维码
							var qrcode = $('#erweicode').qrcode({
								width: 140,
								height: 140,
								text: "{\"type\":\"zc\",\"key\":\"" + mUser.assetscode + "\"}"
							});
							var canvas = qrcode.find('canvas').get(0);
							var img = canvas.toDataURL('image/jpg');
							var imgHtml = `<img src='${img}' width='100%' height='100%'>`;
							$('#erweicode').html(imgHtml);
							$('#downloadImg').on('click', () => {
								saveImage();
							});
							$('#printImg').on('click', () => {
								$('#erweicode').print();
							});

							function saveImage() {
								var a = document.createElement('a');
								a.href = canvas.toDataURL('image/jpg');
								a.download = '二维码.jpg';
								a.click();
							}
						}
					});
				}
				// 新增类型弹窗
				function showTypeEditModel(mUser) {
					admin.open({
						type: 1,
						area: '460px',
						title: mUser == '添加' ? '添加' : '修改',
						content: $('#modelAssetsType').html(),
						success: function(layero, dIndex) {
							$("#AssetsTypeid").val(mUser.id);
							$('#AssetsTypename').val(mUser.typename);
							// 表单提交事件
							form.on('submit(modelSubmitAddAssetsType)', function(data) {
								layer.load(2);
								var json = JSON.stringify({
									typename: $('#AssetsTypename').val(),
									zhandian_id: localStorage.getItem("station_id"),
									id: mUser.id
								});
								$.ajax({
									url: url + '/zichan/addassetstype',
									type: 'post',
									async: false,
									contentType: 'application/json;utf-8',
									dataType: 'json',
									data: json,
									success: function(res) {
										layer.closeAll('loading');
										if (res.code == 0) {
											layer.close(dIndex);
											layer.msg(res.msg, {
												icon: 1
											});
											insTb1.reload();
										} else {
											layer.msg(res.msg, {
												icon: 2
											});
										}
										insTb1.reload();
									}
								});
								return false;

							});
						}
					});
				}
				// 新增构件库弹窗
				function showclEditModel(mUser) {
					admin.open({
						type: 1,
						area: '460px',
						title: mUser == '添加' ? '添加' : '修改',
						content: $('#modelAssetscl').html(),
						success: function(layero, dIndex) {
							$("#Assetsclid").val(mUser.id);
							$('#clname').val(mUser.clname);
							// 表单提交事件
							form.on('submit(modelSubmitAddAssetscl)', function(data) {
								debugger;
								layer.load(2);
								var json = JSON.stringify({
									clname: $('#clname').val(),
									zhandian_id: localStorage.getItem("station_id"),
									id: mUser.id
								});
								$.ajax({
									url: url + '/zichan/addassetscl',
									type: 'post',
									async: false,
									contentType: 'application/json;utf-8',
									dataType: 'json',
									data: json,
									success: function(res) {
										debugger;
										layer.closeAll('loading');
										if (res.code == 0) {
											layer.close(dIndex);
											layer.msg(res.msg, {
												icon: 1
											});
											insTb2.reload();
										} else {
											layer.msg(res.msg, {
												icon: 2
											});
										}
										insTb2.reload();
									}
								});
								return false;

							});
						}
					});
				}
				// 新增构件库弹窗
				function showclrkEditModel(mUser) {
					admin.open({
						type: 1,
						area: '460px',
						title: mUser == '添加' ? '添加' : '修改',
						content: $('#modelAssetsclrk').html(),
						success: function(layero, dIndex) {
							$("#Assetsclid").val(mUser.id);
							$('#clname').val(mUser.clname);
							// 表单提交事件
							form.on('submit(modelSubmitAddAssetsclrk)', function(data) {
								debugger;
								layer.load(2);
								var json = JSON.stringify({
									clname: $('#clname').val(),
									zhandian_id: localStorage.getItem("station_id"),
									id: mUser.id
								});
								$.ajax({
									url: url + '/zichan/addassetscl',
									type: 'post',
									async: false,
									contentType: 'application/json;utf-8',
									dataType: 'json',
									data: json,
									success: function(res) {
										debugger;
										layer.closeAll('loading');
										if (res.code == 0) {
											layer.close(dIndex);
											layer.msg(res.msg, {
												icon: 1
											});
											insTb2.reload();
										} else {
											layer.msg(res.msg, {
												icon: 2
											});
										}
										insTb2.reload();
									}
								});
								return false;

							});
						}
					});
				}
				// 显示表单弹窗
				function showEditModel(mUser) {
					admin.open({
						type: 1,
						area: '860px',
						title: mUser == '添加' ? '添加' : '修改',
						content: $('#modelProperty').html(),
						success: function(layero, dIndex) {
							bindtype();
							bindUser();
							bindcl();
							getuploadfile(0);
							if (mUser != '添加') {

								var arr = mUser.assetscl_id.split(',');
								form.val('modelAssetsForm', mUser);
								$("#lblist").val(mUser.assetstype_id);
								var formSelects = layui.formSelects;
								formSelects.value('cllist', arr);
								$("#zrrlist").val(mUser.user_id);
								$("#assetsstatus").val(mUser.assetsstatus);
								form.render();
								var append = '<li><input type="hidden" name="file_url" value="' + mUser.file_url +
									'"/><label>' + mUser.file_url +
									'</label></li>';
								$("#ulfile_0").append(append);
							}
							//执行一个laydate实例
							laydate.render({
								elem: '#cg_date' //指定元素
							});
							laydate.render({
								elem: '#rk_date' //指定元素
							});
							var img = new Image;
							img.crossOrigin = "anonymous"; //关键
							// 生成二维码
							$('#erweicode').qrcode({
								width: 130,
								height: 130,
								// text: "id=" + mUser.id
								text: "{\"type\":\"zc\",\"key\":\"" + mUser.assetscode + "\"}"
							});
							// 生成二维码
							var qrcode = $('#erweicode').qrcode({
								width: 140,
								height: 140,
								text: "{\"type\":\"zc\",\"key\":\"" + mUser.assetscode + "\"}"
							}).hide();
							var canvas = qrcode.find('canvas').get(0);
							img = canvas.toDataURL('image/jpg');
							var imgHtml = `<img src='${img}' width='100%' height='100%'>`;
							$('#erweicode').html(imgHtml);
							$('#downloadImg').on('click', () => {
								saveImage();
							});

							function saveImage() {
								var a = document.createElement('a');
								a.href = canvas.toDataURL('image/jpg');
								a.download = '二维码.jpg';
								a.click();
							}
							// 上传头像
							var insUpload = upload.render({
								elem: '#contract-upload', //绑定元素
								url: url + '/upload/file', //上传接口
								done: function(res) {
									//上传完毕回调
									headFile = res.data.filePath;
									var append = '<li img_url="' + headFile +
										'" class="pull-left supply-img-item"><img src="' + imgUrl + headFile +
										'"><i   class="supply-img-close  layui-icon" onclick="getdeleteImg(this)">&#x1006;</i></li>';
									$("#img_list").append(append);
									//alert("图片上传成功，路劲为：" + headFile);
								},
								error: function() {
									//请求异常回调
								}
							});

							// 表单提交事件
							form.on('submit(modelSubmitAddCustomer)', function(data) {
								layer.load(2);
								var parm = data.field;
								var formSelects = layui.formSelects;
								var json = JSON.stringify({
									...data.field,
									zhandian_id: localStorage.getItem("station_id"),
									assetscl_id: formSelects.value('cllist', 'valStr'),
									assetsclname: formSelects.value('cllist', 'nameStr'),
									assetstype_id: $("#lblist").val(),
									assetstypename: $("#lblist option:selected").text(),
									user_id: $("#zrrlist").val(),
									user_name: $("#zrrlist option:selected").text(),
									assetsstatus: $("#assetsstatus").val(),
									id: mUser.id
								});
								$.ajax({
									url: url + '/zichan/addzichanassets',
									type: 'post',
									async: false,
									contentType: 'application/json;utf-8',
									dataType: 'json',
									data: json,
									success: function(res) {
										debugger;
										layer.closeAll('loading');
										if (res.code == 0) {
											// layer.msg(res.msg, {
											// 	icon: 1
											// });

											layer.confirm('保存成功, 是否下载或打印二维码?', {
												btn: ['下载', '打印', '跳过'],
												btn3: function(index, layero) {
													console.log('跳过');
													layer.close(dIndex);
												}
											}, function(index, layero) {
												console.log('下载');
												saveImage();
												layer.close(layer.index);
												layer.close(dIndex);
											}, function(index, layero) {
												console.log('打印');
												$('#erweicode').show();
												$('#erweicode').print({
													title: ''
												});
												layer.close(dIndex);
											});
											insTb.reload();
										} else {
											layer.msg(res.msg, {
												icon: 2
											});
										}
									}
								});

							});
						}
					});
				}
				// 新增项目
				$('#btnAddProject').on('click', (e) => {

				});

				//一些事件监听
				element.on('tab(projectSetting)', function(data) {
					console.log(data);
				});

			});

			function getdeleteImg(ii) {
				ii.parentNode.parentNode.removeChild(ii.parentNode);
			}
		</script>

	</body>
</html>
