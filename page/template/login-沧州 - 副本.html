<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>登录</title>
		<link rel="stylesheet" href="../../assets/libs/layui/css/layui.css" />
		<link rel="stylesheet" href="../../assets/css/loginPage.css?v=314">
		<link rel="stylesheet" href="../../assets/module/admin.css?v=314">
		<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
		<style>
			.layui-card-header{
            border-bottom: 0 solid #f6f6f6 !important;
        }
        .layui-btn{
            height:2.604vw;
            background: #1AB99B;
            border-radius:3px;
        }
        .copyright {
            text-align: center;
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size:16px;
            font-family:PingFangSC-Regular,PingFang SC;
            font-weight:400;
            color:rgba(255,255,255,1);
        }
        .login-i {
            background: url(../../assets/images/loginpage_log.png) no-repeat;
            background-size: 100% 100%;
        }
        .login-i.login-b {
            background-image: url(../../assets/images/banzhan_cz_logo.png);
        }
        .login-i.login-sh {
        	background-image: url(../../assets/images/logo_shanghai.png);
        	top: 90px;
        	left: 180px;
        }
    </style>
		<script>
			if (window != top) {
            top.location.replace(location.href);
        }
    </script>
	</head>
	<body>
		<div class="login-i">
			<!-- <img src="../../assets/images/loginpage_log.png"/> -->
		</div>
		<div class="login-i-text" id="div_name">沥青混合料智慧生产管控系统</div>
		<div class="login-wrapper">
			<div class="login-body">
				<!--        <div class="login-img">-->
				<!--            <div class="lg_pading">-->
				<!--            <h4 class="lg_title">欢迎来到<img src="../../assets/images/cjlogin.png"/> </h4>-->
				<!--            <div class="line"></div>-->
				<!--                <h4 class="lg_title">再生工厂智慧生产管理系统</h4>-->
				<!--            </div>-->
				<!--        </div>-->
				<div class="layui-card">
					<div class="layui-card-header title  itempading">
						登录
					</div>
					<form class="layui-card-body layui-form layui-form-pane">
						<div class="layui-form-item">
							<label class="layui-form-label"><i class="layui-icon "><img class="iphoto" src="../../assets/images/iphoto.png">
								</i></label>
							<div class="layui-input-block">
								<input name="username" type="text" placeholder="账号" class="layui-input" lay-verType="tips" lay-verify="required"
								 required />
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label"><i class="layui-icon "><img class="suo" src="../../assets/images/suo.png"> </i></label>
							<div class="layui-input-block">
								<input name="password" id="password" type="password" placeholder="密码" class="layui-input" lay-verType="tips"
								 lay-verify="required" required />
								<span class="clear-btn" id="btn" style="display: inline;">
									<img id="look1" src="../../assets/images/look1.png">
									<img id="look2" src="../../assets/images/look2.png">
								</span>

							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label"><i class="layui-icon layui-icon-vercode"></i></label>
							<div class="layui-input-block">
								<div class="layui-row inline-block">
									<div class="layui-col-xs7">
										<input name="code" type="text" placeholder="验证码" class="layui-input" autocomplete="off" lay-vertype="tips"
										 lay-verify="required" required="">
									</div>
									<div class="layui-col-xs5" style="padding-left: 6px;">
										<img class="login-captcha" src="https://www.oschina.net/action/user/captcha">
									</div>
								</div>
							</div>
						</div>
						<!--                        <div class="layui-form-item">-->
						<!--                            <label class="layui-form-label"><i class="layui-icon layui-icon-vercode"></i></label>-->
						<!--                            <div class="layui-input-block">-->
						<!--                                <div class="layui-row inline-block">-->
						<!--                                    <div class="layui-col-xs7">-->
						<!--                                        <input name="code" type="text" placeholder="验证码" class="layui-input"-->
						<!--                                               autocomplete="off" lay-verType="tips" lay-verify="required" required/>-->
						<!--                                    </div>-->
						<!--                                    <div class="layui-col-xs5" style="padding-left: 6px;">-->
						<!--                                        <img class="login-captcha" src="https://www.oschina.net/action/user/captcha">-->
						<!--                                    </div>-->
						<!--                                </div>-->
						<!--                            </div>-->
						<!--                        </div>-->
						<!--                        <div class="layui-form-item">-->
						<!--                            <a href="javascript:;" class="layui-link">帐号注册</a>-->
						<!--                            <a href="javascript:;" class="layui-link pull-right">忘记密码？</a>-->
						<!--                        </div>-->
						<div class="layui-form-item">
							<button lay-filter="login-submit" class="layui-btn layui-btn-fluid" lay-submit>登 录</button>
						</div>
						<!--                        <div class="layui-form-item login-other">-->
						<!--                            <label>第三方登录</label>-->
						<!--                            <a href="javascript:;"><i class="layui-icon layui-icon-login-qq"></i></a>-->
						<!--                            <a href="javascript:;"><i class="layui-icon layui-icon-login-wechat"></i></a>-->
						<!--                            <a href="javascript:;"><i class="layui-icon layui-icon-login-weibo"></i></a>-->
						<!--                        </div>-->
					</form>
				</div>

			</div>

		</div>
		<div class="copyright">@版权所有 广州市市政实业有限公司 @2020 All Right Reserved</div>
		<!-- js部分 -->
		<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
		<script type="text/javascript" src="../../assets/js/common.js?v=314"></script>
		<script>
			layui.use(['layer', 'form'], function() {
				var $ = layui.jquery;
				var layer = layui.layer;
				var form = layui.form;
				// 提取路由中项目名称
				var page = 'guangzhou';
				if (window.location.search) {
					page = window.location.search.substring(1).split('=')[1];
					window.localStorage.setItem('page', page)
				} else if (window.localStorage.getItem('page')) {
					page = window.localStorage.getItem('page')
				}
				if (page === 'gz') {

				} else if (page === 'sh') {
					// 上海
					$('body').addClass('banzhan');
					$('.login-i').addClass('login-sh');
					$('.login-i-text').addClass('login-b-text');
					$('.copyright').html('@版权所有 上海公路桥梁集团有限公司 @2020 All Right Reserved')
				} else if(page==='cz'){
					$('body').addClass('banzhan');
					$('.login-i').addClass('login-b');
					$('.login-i-text').addClass('login-b-text');
					$('.copyright').html('@版权所有 沧州市市政工程股份有限公司 @2020 All Right Reserved')
					$("#div_name").html('沥青路面智能管理系统');
				}
				else{
					// 拌站精灵
					$('body').addClass('banzhan');
					$('.login-i').addClass('login-b');
					$('.login-i-text').addClass('login-b-text');
					$('.copyright').html('@版权所有 南京西麦信息科技有限公司 @2020 All Right Reserved')
				}
				console.log(page)
				// 表单提交
				form.on('submit(login-submit)', function(obj) {
					//ajax提交表单
					//Ajax获取
					// $.post('192.168.0.10', {}, function(str){
					//     layer.open({
					//         type: 1,
					//         content: str //注意，如果str是object，那么需要字符拼接。
					//     });
					// });
					var username = obj.field.username;
					var password = obj.field.password;
					var serverUrl = url;
					// var  serverUrl='http://192.168.0.16:8080';
					console.log(username);

					$.ajax({
						url: serverUrl + '/user/login',
						type: 'POST',
						data: {
							'username': username,
							'password': password,
						},
						success: function(res) {
							console.log(res);
							if (res.cod == "002") {
								var data1 = res.data;
								localStorage.setItem("userid", data1.userid);
								localStorage.setItem("token", data1.token);
								localStorage.setItem("role_id", data1.role_id);
								localStorage.setItem("role", data1.role);
								localStorage.setItem("username", res.user.username);
								// localStorage.setItem("station","璧山站");						 
								// localStorage.setItem("station_list","两江站,璧山站,双石站,朱沱站");
								layer.msg(res.msg, {
									icon: 1,
									time: 1500
								}, function() {
									location.replace('../../index.html')
								});
							} else {
								layer.msg(res.msg);
							}
						},
						error: function(res) {
							layer.msg("服务器请求错误")

						}
					});

					// console.log(obj.field);
					// layer.msg('登录成功', {icon: 1, time: 1500}, function () {
					//     // location.replace('../../index.html')
					// });
					return false;
				});
				//密码可见
				var isPs = false;
				var count = 0;
				var look1 = document.getElementById('look1');
				var look2 = document.getElementById('look2');
				var Input = document.getElementById('password');
				$("#btn").click(function() {
					if (isPs) {
						Input.setAttribute("type", "password");
						isPs = false;


					} else {
						Input.setAttribute("type", "text");
						isPs = true;

					}
					count++;
					if (count % 2 == 1) {
						look1.style.display = "none";
						look2.style.display = "block";
					} else {
						look1.style.display = 'block';
						look2.style.display = "none";
					}

				});

				// 图形验证码
				$('.login-captcha').click(function() {
					this.src = this.src + '?t=' + (new Date).getTime();
				});
			});
		</script>
	</body>
</html>
