<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>站长审核详情</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=314"/>
    <link rel="stylesheet" href="../../assets/css/common_likui.css?v=314"/>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-form-label {
            min-width: 130px;
            box-sizing: border-box;
            padding-left: 0;
        }
        .layui-form-item .layui-input-inline {
            width: calc(100% - 140px);
            margin-right: 0;
        }
        .task-container {
            padding: 30px 30px 0;
            box-shadow:0px 1px 11px 0px rgba(239,244,255,1);
            border-radius:2px;
        }
        .task-tip {
            color: rgba(107, 107, 107, 1);
            line-height: 30px;
            font-size: 12px;
        }
        .task-title {
            border-left: 4px solid rgba(26, 185, 155, 1);
            padding-left: 8px;
            font-size: 14px;
            line-height: 20px;
            color: rgba(51, 51, 51, 1);
            position: relative;
            font-weight: bold;
        }
        .task-title:after {
            content: '';
            width: calc(100% - 70px);
            border-top: 1px dashed rgba(208, 211, 221, 1);
            position: absolute;
            right: 0;
            top: 9px;
        }
        .task-content {
            padding: 20px 10px;
        }
		.notclickn{
			pointer-events: none;
		}
        .audit-title {
            color: #333;
            font-size: 14px;
            font-weight: bold;
        }
    </style>

</head>
<body>

<!-- 页面加载loading -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>

<!-- 正文开始 -->
<div class="layui-fluid" id="form1">
    <div class="task-tip mt-10"><span class="text-red">*</span>红色为必填项</div>
    <div class="task-container bg-white layui-form">
        <div class="task-item">
            <div class="task-title">基本信息</div>
            <div class="task-content layui-form-item">
                <div class="layui-row">
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">项目名称</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="engineer_name" class="layui-input" type="text"  readonly="readonly"  placeholder="请输入项目名称"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">砼类型</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="concrete_name" class="layui-input" type="text"  readonly="readonly"  placeholder="请输入硂类型"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">计划量</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="plan_amount" readonly="readonly" class="layui-input" type="text"   placeholder="请输入计划量"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="task-item">
            <div class="task-title">生产任务明细</div>
            <div class="task-content layui-form-item">
                <div class="layui-row">
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">任务单号</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="task_no" class="layui-input"  readonly="readonly"  type="text" placeholder="请输入任务单号"/>
                        </div>
                    </div>
                    <div class="layui-col-md8 p-10">
                        <label class="layui-form-label w-auto">计划开始时间</label>
                        <div class="layui-input-block" style="margin-bottom: 0px;">
                            <input id="start_time" name="scheduled_open" class="layui-input" readonly="readonly"   style="width: 180px;display: inline-block;" type="text" placeholder="请选择"/>
                            -
                            <input id="end_time" name="schedule_end" class="layui-input" readonly="readonly"   style="width: 180px;display: inline-block;" type="text" placeholder="请选择"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">运输方式</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="transport_way" class="layui-input" readonly="readonly"   type="text" placeholder="请输入运输方式"/>
                        </div>
                    </div>
                    <div class="layui-col-md8 p-10">
                        <label class="layui-form-label w-auto">运输地点</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="factory_addr" class="layui-input" readonly="readonly"   style="width: 375px;" type="text" placeholder="请输入运输地点"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">前场联系人</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="factory_link_name" class="layui-input" readonly="readonly"   type="text" placeholder="请输入前场联系人"/>
                        </div>
                    </div>
                    <div class="layui-col-md8 p-10">
                        <label class="layui-form-label w-auto">电话</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="factory_link_phone" class="layui-input" readonly="readonly"   style="width: 375px;" type="text" placeholder="请输入电话"/>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md4 p-10">
                    <label class="layui-form-label w-auto">工地需求供应时间</label>
                    <div class="layui-input-inline" style="margin-bottom: 0px;">
                        <input name="site_supply" class="layui-input"  readonly="readonly"  type="text" placeholder="请输入工地需求供应时间"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="task-item">
            <div class="task-title">配比明细</div>
            <div class="task-content layui-form-item" style="margin-bottom: 0;">
                <div class="layui-row">
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">级配编号</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="jpbh" class="layui-input" readonly="readonly"  placeholder="请输入级配编号"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">区间温度</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="qjwd" class="layui-input" readonly="readonly"  placeholder="请输入区间温度"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">沥青标号</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="interval_start" class="layui-input" readonly="readonly"  placeholder="请输入沥青标号"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">级配模板</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="jpmb" class="layui-input" readonly="readonly"  placeholder="请输入级配模板"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">天气</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="tq" class="layui-input" readonly="readonly"  placeholder="请输入天气"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">班次</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="bc" class="layui-input" readonly="readonly" placeholder="请输入班次"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto"><span class="text-red">*</span>产品出厂温度(℃)</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="cpccwd" class="layui-input" readonly="readonly" placeholder="请输入产品出厂温度"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">石料加热温度(℃)</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="sljrwd" class="layui-input" readonly="readonly" placeholder="请输入石料加热温度"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">干拌时间(s)</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="gbsj" class="layui-input" readonly="readonly" placeholder="请输入干拌时间"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">沥青加热温度(℃)</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="lqjrwd" class="layui-input" readonly="readonly" placeholder="请输入沥青加热温度"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">机号</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="jh" class="layui-input" readonly="readonly" placeholder="请输入机号"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">审核状态</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="zt" class="layui-input" readonly="readonly" placeholder="审核状态"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">日期</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input id="rq" name="dateVal" class="layui-input" readonly="readonly" placeholder="请选择日期"/>
                        </div>
                    </div>
                    <div class="layui-col-md4 p-10">
                        <label class="layui-form-label w-auto">湿拌时间(s)</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <input name="sbsj" class="layui-input" readonly="readonly" placeholder="请输入湿拌时间"/>
                        </div>
                    </div>
                    <div class="layui-col-md12 p-10">
                        <label class="layui-form-label w-auto">备注</label>
                        <div class="layui-input-inline" style="margin-bottom: 0px;">
                            <textarea name="bz" placeholder="请输入备注" class="layui-textarea"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="task-item mt-20">
            <div class="layui-row">
                <div class="layui-col-md6 p-10">
                    <div class="audit-title">
                        冷料仓配比

                    </div>
                    <table class="layui-table" id="tableCold" lay-filter="tableCold" style="margin: 0;"></table>
                </div>
                <div class="layui-col-md6 p-10">
                    <div class="audit-title">
                        热料仓配比

                    </div>
                    <table class="layui-table" id="tableHot" lay-filter="tableHot" style="margin: 0;"></table>
                </div>
            </div>
        </div>
    </div>
        
		<input type="hidden" id="task_id" name="task_id" />
        <div id="btns"class="text-center p-30">
            <button id="sh" class="layui-btn layui-btn-yellow1" lay-filter="formEdit" lay-submit>审核</button>
        </div>
    </div>
</div>

<!-- js部分 -->
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=314"></script>
<script type="text/javascript" src="../../assets/libs/jquery/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../assets/js/tongyong.js?1234"></script>
<script>
	
	//url="http://localhost:8080/";
    layui.use(['layer', 'form', 'table', 'util', 'admin', 'element', 'laydate'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var table = layui.table;
        var util = layui.util;
        var admin = layui.admin;
        var element = layui.element;
		var laydate = layui.laydate;
		var taskId = getQueryString('taskId');
		setDateInit(laydate);
        var list1 = [{type: '', yclcs: '', yclgg: '', zl: '', remark: ''}];
        var list2 = [{type: '', zl: '', remark: ''}];
        var shlx = getQueryString('shlx');
        var insTb1 = table.render({
            elem: '#tableCold',
            data: list1,
            cols: [[
                {field: 'llcgg', align: 'center', title: '冷料仓规格', edit: 'text'},
                {field: 'yclcs', align: 'center', title: '原材料厂商', edit: 'text'},
                {field: 'yclgg', align: 'center', title: '原材料规格', edit: 'text'},
                {field: 'zl', align: 'center', title: '重量(kg)', edit: 'text'},
                {field: 'bz', align: 'center', title: '备注', edit: 'text'}
            ]]
        });
        var insTb2 = table.render({
            elem: '#tableHot',
            data: list2,
            cols: [[
                {field: 'rlc', align: 'center', title: '热料仓', edit: 'text'},
                {field: 'zl', align: 'center', title: '重量(kg)', edit: 'text'},
                {field: 'bz', align: 'center', title: '备注', edit: 'text'}
            ]]
        });
        function getModel(data){
            $.post(url+'/jipei/getModelTask', data, function (res) {
                if (res.code ==0) {
                    console.info(res);
                    formSet('form1',res.data);
                    list1= res.data.llcpb;
                    list2= res.data.rlcpb;
                    console.info(list1);
                    console.info(list2);
                    reTb1();
                    reTb2();
                    layui.form.render('select')
                } else {
                    layer.msg(res.msg, {icon: 2});
                }
            }, 'json');
            $.get(url+'/production/getTaskDetail?taskId='+data.taskId, function (res) {
                if (res.code ==0) {
                    console.info(res);
                    formSet('form1',res.data);
                    layui.form.render('select')
                } else {
                    layer.msg(res.msg, {icon: 2});
                }
            }, 'json');
        }
        function reTb1(){
            insTb1.reload({
                data: list1
            })
        }
        function reTb2(){
            insTb2.reload({
                data: list2
            })
        }
        function formSet(formId,data) {
            for(var key in data){
                $("#"+formId+" [name='"+key+"']").val(data[key]);
            }
        }
        function formSet(formId,data) {
            for(var key in data){
                $("#"+formId+" [name='"+key+"']").val(data[key]);
            }
        }
        getModel({taskId:taskId})
        var isDetail = getQueryString('isDetail');
        if(isDetail){
            $('#btns').hide();
        }
        $('#sh').on('click', () => {
            layer.confirm('确定要审核通过吗？', {
                skin: 'layui-layer-admin',
                shade: .1
            }, function() {
                xmsy();
            });
        })
        function xmsy(){
            layer.load(2);
            $.post(url + '/qianhe/addShRecord', {
                shlx:shlx,
                shr:localStorage.getItem("userid"),
                shzt:1,
                shId:taskId
            }, function(res) {
                layer.closeAll('loading');
                if (res.code == 0) {
                    layer.msg(res.msg, {
                        icon: 1
                    });
                    parent.location.reload();
                    parent.layui.admin.events.closeThisTabs()
                } else {
                    layer.msg(res.msg, {
                        icon: 2
                    });
                }
            }, 'json');
        }
		
	});
	
	function setDateInit(laydate){
		//开始时间
		laydate.render({
		    elem: '#start_time',
		    trigger: 'click',
		    format: 'yyyy-MM-dd',
		    done: function (value, date, endDate) {
		        var date = new Date(value).getTime();
		        console.log(date, '开始时间')
		    }
		});
		//结束时间
		laydate.render({
		    elem: '#end_time',
		    trigger: 'click',
		    format: 'yyyy-MM-dd',
		    done: function (value, date, endDate) {
		        var date = new Date(value).getTime();
		        console.log(date, '结束时间')
		    }
		});
		//日期
		laydate.render({
		    elem: '#dateVal',
		    trigger: 'click',
		    format: 'yyyy-MM-dd',
		    done: function (value, date, endDate) {
		        var date = new Date(value).getTime();
		        console.log(date, '日期')
		    }
		});

	}
</script>

</body>
</html>